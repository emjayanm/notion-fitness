<!-- ‚≠ê Gold Star Workout Streak Widget by Sarah at emjayanm.com-->
<div id="widget" style="background:#ffffff; color:#000; padding:20px; font-family: Georgia; font-size:12pt; text-align:center; border-radius:12px; max-width:420px; margin:auto; box-shadow:0 4px 10px rgba(0,0,0,0.1);">
  <h2 style="font-size:16pt; margin-bottom:10px;">‚≠ê Weekly Workout Tracker ‚≠ê</h2>

  <div id="setup">
    <label for="duration">Choose workout duration:</label><br>
    <select id="duration" style="margin:8px 0;">
      <option>15 minutes</option>
      <option selected>30 minutes</option>
      <option>45 minutes</option>
      <option>60 minutes</option>
    </select><br>

    <label for="goal">Choose days per week:</label><br>
    <select id="goal" style="margin-bottom:10px;">
      <option>2</option>
      <option>3</option>
      <option>4</option>
      <option selected>5</option>
      <option>6</option>
    </select><br>

    <button onclick="saveGoal()" style="padding:8px 16px; margin-top:10px;">Set Goal</button>
  </div>

  <div id="tracker" style="display:none;">
    <p id="goalSummary"></p>
    <div id="stars" style="font-size:24pt; margin:10px 0;"></div>
    <p id="status" style="margin:6px 0;"></p>
    <p id="streakMessage" style="margin:6px 0;"></p>
    <button onclick="manualReset()" style="margin:10px 0; padding:6px 14px;">üîÅ Reset Progress</button>
  </div>

  <p id="countdown" style="margin-top:10px;"></p>
</div>

<script>
  const durationEl = document.getElementById("duration");
  const goalEl = document.getElementById("goal");
  const setup = document.getElementById("setup");
  const tracker = document.getElementById("tracker");
  const starsContainer = document.getElementById("stars");
  const status = document.getElementById("status");
  const goalSummary = document.getElementById("goalSummary");
  const countdown = document.getElementById("countdown");
  const streakMessage = document.getElementById("streakMessage");

  let starGoal = parseInt(localStorage.getItem("starGoal")) || null;
  let streak = parseInt(localStorage.getItem("streak")) || 0;
  let stars = JSON.parse(localStorage.getItem("stars")) || [];
  let resetTime = parseInt(localStorage.getItem("resetTime")) || getNextMonday();

  function saveGoal() {
    starGoal = parseInt(goalEl.value);
    stars = Array(starGoal).fill(false);
    localStorage.setItem("starGoal", starGoal);
    localStorage.setItem("stars", JSON.stringify(stars));
    localStorage.setItem("resetTime", resetTime);
    renderWidget();
  }

  function renderWidget() {
    if (!starGoal) return;
    setup.style.display = "none";
    tracker.style.display = "block";
    goalSummary.textContent = `üéØ Goal: ${starGoal} workouts of ${durationEl.value} this week`;

    starsContainer.innerHTML = "";
    stars.forEach((filled, index) => {
      const star = document.createElement("span");
      star.textContent = filled ? "‚≠ê" : "‚òÜ";
      star.style.cursor = filled ? "default" : "pointer";
      star.onclick = () => {
        if (!filled) {
          stars[index] = true;
          localStorage.setItem("stars", JSON.stringify(stars));
          renderWidget();
          checkCompletion();
        }
      };
      starsContainer.appendChild(star);
    });

    const completed = stars.filter(Boolean).length;
    const remaining = starGoal - completed;
    status.textContent = completed >= starGoal
      ? "üéâ Goal Complete! Amazing job!"
      : `üí™ ${remaining} more to go!`;

    // Streak message
    if (completed >= starGoal) {
      streak++;
      localStorage.setItem("streak", streak);
      if (streak >= 10) {
        streakMessage.textContent = "üèÖ 10-week master streak!";
      } else if (streak >= 5) {
        streakMessage.textContent = "üèÜ 5-week streak ‚Äî you‚Äôre on fire!";
      } else if (streak >= 3) {
        streakMessage.textContent = "ü•â 3-week streak ‚Äî keep going!";
      } else {
        streakMessage.textContent = `üî• Streak: ${streak} week${streak > 1 ? "s" : ""}`;
      }

      // Confetti üéâ
      const confetti = document.createElement("div");
      confetti.textContent = "üéâ";
      confetti.style.position = "fixed";
      confetti.style.top = "50%";
      confetti.style.left = "50%";
      confetti.style.fontSize = "48px";
      document.body.appendChild(confetti);
      setTimeout(() => confetti.remove(), 2000);
    } else {
      streakMessage.textContent = `üî• Streak: ${streak} week${streak > 1 ? "s" : ""}`;
    }
  }

  function manualReset() {
    starGoal = null;
    stars = [];
    localStorage.removeItem("starGoal");
    localStorage.removeItem("stars");
    setup.style.display = "block";
    tracker.style.display = "none";
    renderCountdown();
  }

  function getNextMonday() {
    const now = new Date();
    const day = now.getDay();
    const diff = (8 - day) % 7 || 7;
    now.setDate(now.getDate() + diff);
    now.setHours(0, 0, 0, 0);
    return now.getTime();
  }

  function checkReset() {
    const now = new Date().getTime();
    if (now >= resetTime) {
      // Reset only star progress
      stars = Array(starGoal || 0).fill(false);
      localStorage.setItem("stars", JSON.stringify(stars));
      resetTime = getNextMonday();
      localStorage.setItem("resetTime", resetTime);
      renderWidget();
    }
  }

  function renderCountdown() {
    const now = new Date().getTime();
    const distance = resetTime - now;
    const d = Math.floor(distance / (1000 * 60 * 60 * 24));
    const h = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const m = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    countdown.textContent = `‚è≥ Resets in ${d}d ${h}h ${m}m`;
  }

  // Init
  checkReset();
  renderWidget();
  renderCountdown();
  setInterval(renderCountdown, 60000);
</script>

